# üé® Sistema de Formularios Gen√©ricos Modernos

## üìã Tabla de Contenidos

1. [Introducci√≥n](#introducci√≥n)
2. [Nuevas Caracter√≠sticas](#nuevas-caracter√≠sticas)
3. [Gu√≠a de Uso](#gu√≠a-de-uso)
4. [Ejemplos Pr√°cticos](#ejemplos-pr√°cticos)
5. [API Reference](#api-reference)
6. [Mejores Pr√°cticas](#mejores-pr√°cticas)

---

## üéØ Introducci√≥n

El sistema de formularios gen√©ricos ha sido modernizado con un dise√±o completamente responsive y nuevas caracter√≠sticas que te permiten controlar la visibilidad, agrupaci√≥n y comportamiento de los campos del formulario de manera declarativa.

### ¬øQu√© cambi√≥?

- ‚úÖ **Dise√±o moderno y responsive** con gradientes y animaciones
- ‚úÖ **Visibilidad condicional** de campos seg√∫n otros valores
- ‚úÖ **Deshabilitado condicional** de campos
- ‚úÖ **Secciones y agrupaci√≥n** para organizar campos
- ‚úÖ **Grid flexible** con soporte para columnas (colSpan)
- ‚úÖ **Prefijos y sufijos** para inputs (Ej: "Bs.", "%", "$")
- ‚úÖ **Descripciones de ayuda** en cada campo
- ‚úÖ **Mejor manejo de errores** con alertas visuales
- ‚úÖ **Animaciones suaves** para mejor UX

---

## üÜï Nuevas Caracter√≠sticas

### 1. Visibilidad Condicional

Muestra u oculta campos seg√∫n el valor de otros campos:

```typescript
{
    key: 'usernick',
    label: 'Nombre de Usuario',
    type: 'text',
    // üÜï Solo visible si puede_acceder_sistema es true
    visible: (data) => !!data.puede_acceder_sistema,
}
```

**Casos de uso:**
- Mostrar campos de usuario solo si se habilita el acceso al sistema
- Mostrar campos espec√≠ficos seg√∫n el tipo de contrato seleccionado
- Ocultar campos opcionales hasta que se cumplan ciertas condiciones

### 2. Deshabilitado Condicional

Deshabilita campos seg√∫n condiciones:

```typescript
{
    key: 'contacto_emergencia_telefono',
    label: 'Tel√©fono de Emergencia',
    type: 'text',
    // üÜï Deshabilitado si no hay nombre de contacto
    disabled: (data) => !data.contacto_emergencia_nombre,
}
```

**Casos de uso:**
- Deshabilitar campos dependientes hasta que se complete el campo padre
- Prevenir edici√≥n de campos calculados
- Deshabilitar campos seg√∫n permisos del usuario

### 3. Ocultamiento Permanente

Oculta campos permanentemente sin eliminarlos de la configuraci√≥n:

```typescript
{
    key: 'campo_interno',
    label: 'Campo Interno',
    type: 'text',
    // üÜï Campo oculto permanentemente
    hidden: true,
}
```

**Casos de uso:**
- Campos que se usan en backend pero no se muestran al usuario
- Campos deprecados que se mantienen por compatibilidad

### 4. Secciones y Agrupaci√≥n

Organiza campos en secciones visuales:

```typescript
// En la configuraci√≥n del m√≥dulo
formSections: [
    {
        id: 'Informaci√≥n Personal',
        title: 'Informaci√≥n Personal',
        description: 'Datos personales del empleado',
        order: 1,
    },
    {
        id: 'Informaci√≥n Laboral',
        title: 'Informaci√≥n Laboral',
        description: 'Datos relacionados con el trabajo',
        order: 2,
    },
],

// En los campos
formFields: [
    {
        key: 'nombre',
        label: 'Nombre',
        type: 'text',
        section: 'Informaci√≥n Personal', // üÜï Asignar a secci√≥n
    },
]
```

**Caracter√≠sticas:**
- T√≠tulos y descripciones de secci√≥n
- Separadores visuales autom√°ticos
- Orden personalizable
- Colapso opcional (pr√≥ximamente)

### 5. Grid Flexible (colSpan)

Controla cu√°ntas columnas ocupa cada campo:

```typescript
{
    key: 'nombre',
    label: 'Nombre Completo',
    type: 'text',
    colSpan: 2, // üÜï Ocupa 2 columnas
}

{
    key: 'direccion',
    label: 'Direcci√≥n',
    type: 'textarea',
    colSpan: 3, // üÜï Ocupa todo el ancho (3 columnas)
}
```

**Valores posibles:**
- `1`: 1 columna (default)
- `2`: 2 columnas
- `3`: Todo el ancho en desktop (responsive en m√≥vil)
- `4`: Ancho completo forzado

**Responsive autom√°tico:**
- **Desktop (lg)**: Grid de 3 columnas
- **Tablet (sm)**: Grid de 2 columnas
- **M√≥vil**: 1 columna (full width)

### 6. Prefijos y Sufijos

Agrega decoradores visuales a los inputs:

```typescript
{
    key: 'salario_base',
    label: 'Salario Base',
    type: 'number',
    prefix: 'Bs.', // üÜï Prefijo de moneda
}

{
    key: 'descuento',
    label: 'Descuento',
    type: 'number',
    suffix: '%', // üÜï Sufijo de porcentaje
}
```

**Casos de uso comunes:**
- Monedas: `prefix: "Bs."`, `prefix: "$"`, `prefix: "‚Ç¨"`
- Porcentajes: `suffix: "%"`
- Unidades: `suffix: "kg"`, `suffix: "m"`, `suffix: "L"`
- Iconos decorativos: `prefix: "üì±"`, `prefix: "‚úâÔ∏è"`

### 7. Descripciones de Ayuda

Agrega texto explicativo a cada campo:

```typescript
{
    key: 'codigo_empleado',
    label: 'C√≥digo de Empleado',
    type: 'text',
    description: 'Se genera autom√°ticamente si se deja vac√≠o', // üÜï
}
```

**Caracter√≠sticas:**
- Tooltip con icono de informaci√≥n en el label
- Texto explicativo debajo del campo si no hay error
- Ayuda contextual para el usuario

---

## üìñ Gu√≠a de Uso

### Paso 1: Actualizar la Configuraci√≥n del M√≥dulo

Abre tu archivo de configuraci√≥n (ej: `empleados.config.ts`) y agrega las nuevas propiedades:

```typescript
import type { ModuleConfig } from '@/domain/entities/generic';
import type { Empleado, EmpleadoFormData } from '@/domain/entities/empleados';

export const empleadosConfig: ModuleConfig<Empleado, EmpleadoFormData> = {
    moduleName: 'empleados',
    singularName: 'empleado',
    pluralName: 'empleados',
    displayName: 'Empleados',
    description: 'Gestiona los empleados de la empresa',

    // üÜï NUEVO: Define el layout del formulario
    formLayout: 'auto', // 'single' | 'two-column' | 'three-column' | 'auto'

    // üÜï NUEVO: Define las secciones del formulario
    formSections: [
        {
            id: 'Informaci√≥n Personal',
            title: 'Informaci√≥n Personal',
            description: 'Datos personales del empleado',
            order: 1,
        },
        // ... m√°s secciones
    ],

    // Campos del formulario
    formFields: [
        // ... campos con nuevas propiedades
    ],

    // ... resto de la configuraci√≥n
};
```

### Paso 2: Configurar los Campos

Agrega las nuevas propiedades a tus campos:

```typescript
formFields: [
    {
        key: 'nombre',
        label: 'Nombre Completo',
        type: 'text',
        required: true,
        placeholder: 'Ej: Juan P√©rez Garc√≠a',

        // üÜï Nuevas propiedades
        section: 'Informaci√≥n Personal',
        colSpan: 2,
        description: 'Nombre completo como aparece en la CI',

        // Propiedades existentes
        validation: { maxLength: 255 },
    },
    {
        key: 'puede_acceder_sistema',
        label: 'Puede Acceder al Sistema',
        type: 'boolean',
        section: 'Acceso',
        colSpan: 3,
        description: 'Habilitar para crear un usuario de sistema',
    },
    {
        key: 'usernick',
        label: 'Nombre de Usuario',
        type: 'text',
        section: 'Acceso',
        colSpan: 1,

        // üÜï Visibilidad condicional
        visible: (data) => !!data.puede_acceder_sistema,

        description: 'Se genera autom√°ticamente',
    },
]
```

### Paso 3: Usar el Formulario (Sin cambios)

El uso del formulario NO cambia, sigue siendo igual:

```typescript
export default function EmpleadosForm({ empleado }: { empleado?: Empleado }) {
    return (
        <AppLayout>
            <GenericFormContainer<Empleado, EmpleadoFormData>
                entity={empleado}
                config={empleadosConfig}
                service={empleadosService}
                initialData={initialEmpleadoData}
            />
        </AppLayout>
    );
}
```

---

## üí° Ejemplos Pr√°cticos

### Ejemplo 1: Formulario de Empleados con Acceso al Sistema

```typescript
formFields: [
    {
        key: 'nombre',
        label: 'Nombre Completo',
        type: 'text',
        required: true,
        section: 'Datos Personales',
        colSpan: 2,
    },
    {
        key: 'ci',
        label: 'CI',
        type: 'text',
        required: true,
        section: 'Datos Personales',
        colSpan: 1,
    },
    {
        key: 'puede_acceder_sistema',
        label: 'Acceso al Sistema',
        type: 'boolean',
        section: 'Acceso',
        colSpan: 3,
        description: '¬øCrear usuario de sistema para este empleado?',
    },
    {
        key: 'email',
        label: 'Email',
        type: 'text',
        section: 'Acceso',
        colSpan: 1,
        prefix: '‚úâÔ∏è',
        visible: (data) => !!data.puede_acceder_sistema,
        description: 'Correo para enviar credenciales',
    },
    {
        key: 'roles',
        label: 'Roles',
        type: 'select',
        options: [],
        section: 'Acceso',
        colSpan: 2,
        visible: (data) => !!data.puede_acceder_sistema,
    },
]
```

**Resultado:**
- Los campos de email y roles solo se muestran si se marca el checkbox "Acceso al Sistema"
- El email tiene un icono de sobre como prefijo
- Todo est√° organizado en secciones

### Ejemplo 2: Formulario de Productos con Precios

```typescript
formFields: [
    {
        key: 'nombre',
        label: 'Nombre del Producto',
        type: 'text',
        required: true,
        section: 'Informaci√≥n B√°sica',
        colSpan: 2,
    },
    {
        key: 'tiene_precio_variable',
        label: 'Precio Variable',
        type: 'boolean',
        section: 'Precios',
        colSpan: 3,
        description: '¬øEl precio var√≠a seg√∫n cantidad o cliente?',
    },
    {
        key: 'precio_base',
        label: 'Precio Base',
        type: 'number',
        required: true,
        section: 'Precios',
        colSpan: 1,
        prefix: 'Bs.',
        disabled: (data) => !!data.tiene_precio_variable,
        description: 'Precio est√°ndar del producto',
    },
    {
        key: 'descuento_maximo',
        label: 'Descuento M√°ximo',
        type: 'number',
        section: 'Precios',
        colSpan: 1,
        suffix: '%',
        visible: (data) => !!data.tiene_precio_variable,
        validation: { min: 0, max: 100 },
    },
]
```

**Resultado:**
- Si "Precio Variable" est√° activado, el "Precio Base" se deshabilita
- El campo "Descuento M√°ximo" solo se muestra si el precio es variable
- Los precios tienen el prefijo "Bs." y los descuentos el sufijo "%"

### Ejemplo 3: Formulario con Contacto de Emergencia

```typescript
formFields: [
    {
        key: 'contacto_emergencia_nombre',
        label: 'Contacto de Emergencia',
        type: 'text',
        section: 'Emergencia',
        colSpan: 2,
        description: 'Persona a contactar en caso de emergencia',
    },
    {
        key: 'contacto_emergencia_telefono',
        label: 'Tel√©fono',
        type: 'text',
        section: 'Emergencia',
        colSpan: 1,
        prefix: 'üì±',
        disabled: (data) => !data.contacto_emergencia_nombre,
        description: 'Solo si hay un contacto registrado',
    },
]
```

**Resultado:**
- El tel√©fono se deshabilita hasta que se ingrese un nombre de contacto
- Tiene un icono de tel√©fono como prefijo

---

## üìö API Reference

### FormField Interface (Nuevas Propiedades)

```typescript
interface FormField<F extends BaseFormData> {
    // ... propiedades existentes ...

    // üÜï Visibilidad y control
    hidden?: boolean;
    visible?: (data: F) => boolean;
    disabled?: (data: F) => boolean;

    // üÜï Agrupaci√≥n y organizaci√≥n
    group?: string;
    section?: string;
    order?: number;
    colSpan?: 1 | 2 | 3 | 4;

    // üÜï UI/UX mejorado
    description?: string;
    icon?: string;
    prefix?: string;
    suffix?: string;
}
```

### ModuleConfig Interface (Nuevas Propiedades)

```typescript
interface ModuleConfig<T extends BaseEntity, F extends BaseFormData> {
    // ... propiedades existentes ...

    // üÜï Form sections
    formSections?: FormSection[];

    // üÜï Form layout
    formLayout?: 'single' | 'two-column' | 'three-column' | 'auto';
}
```

### FormSection Interface

```typescript
interface FormSection {
    id: string;
    title: string;
    description?: string;
    icon?: string;
    collapsible?: boolean;
    defaultCollapsed?: boolean;
    order?: number;
}
```

---

## üéØ Mejores Pr√°cticas

### 1. Organizaci√≥n de Secciones

**‚úÖ Recomendado:**
```typescript
formSections: [
    { id: 'Datos Personales', title: 'Datos Personales', order: 1 },
    { id: 'Datos Laborales', title: 'Datos Laborales', order: 2 },
    { id: 'Contacto', title: 'Informaci√≥n de Contacto', order: 3 },
]
```

**‚ùå Evitar:**
- Demasiadas secciones (m√°x. 5-6)
- Secciones con solo 1-2 campos
- IDs con espacios o caracteres especiales

### 2. Uso de colSpan

**‚úÖ Recomendado:**
```typescript
// Campo importante que necesita espacio
{ key: 'nombre', colSpan: 2 }

// Campo de texto largo
{ key: 'descripcion', type: 'textarea', colSpan: 3 }

// Campos relacionados en la misma fila
{ key: 'precio', colSpan: 1 }
{ key: 'descuento', colSpan: 1 }
{ key: 'total', colSpan: 1 }
```

**‚ùå Evitar:**
- Usar colSpan: 3 en todos los campos (pierde el beneficio del grid)
- Mezclar colSpan sin planificaci√≥n (puede romper el layout)

### 3. Visibilidad Condicional

**‚úÖ Recomendado:**
```typescript
// Condiciones simples y claras
visible: (data) => !!data.puede_acceder_sistema

// M√∫ltiples condiciones
visible: (data) => data.tipo === 'empleado' && data.departamento === 'Ventas'
```

**‚ùå Evitar:**
```typescript
// L√≥gica compleja en visible
visible: (data) => {
    // 20 l√≠neas de c√≥digo complejo...
    return resultado;
}

// Mejor: mover a una funci√≥n externa
const shouldShowField = (data: F) => {
    // l√≥gica compleja
    return resultado;
};

visible: shouldShowField
```

### 4. Descripciones

**‚úÖ Recomendado:**
```typescript
description: 'Se genera autom√°ticamente si se deja vac√≠o'
description: 'Formato: +591 70123456'
description: 'Este campo es opcional'
```

**‚ùå Evitar:**
```typescript
description: 'Campo para ingresar el nombre completo del empleado incluyendo apellido paterno y materno' // Muy largo
description: 'Nombre' // Redundante con el label
```

### 5. Prefijos y Sufijos

**‚úÖ Recomendado:**
```typescript
prefix: 'Bs.'
prefix: '$'
suffix: '%'
suffix: 'kg'
prefix: 'üì±' // Iconos simples
```

**‚ùå Evitar:**
```typescript
prefix: 'Precio en Bolivianos:' // Muy largo
suffix: ' porciento' // Usar '%' en su lugar
```

---

## üîß Troubleshooting

### Problema: Los campos no se muestran en el orden esperado

**Soluci√≥n:**
Aseg√∫rate de que todos los campos tengan la propiedad `section` asignada. Los campos sin secci√≥n ir√°n a 'default' y aparecer√°n al final.

### Problema: El grid no se ve responsive

**Soluci√≥n:**
Verifica que est√©s usando Tailwind CSS correctamente. El grid es responsive por defecto:
- `grid-cols-1` en m√≥vil
- `sm:grid-cols-2` en tablet
- `lg:grid-cols-3` en desktop

### Problema: La funci√≥n `visible` no funciona

**Soluci√≥n:**
- Verifica que la funci√≥n retorne un boolean
- Aseg√∫rate de que los campos referenciados existan en `data`
- Revisa la consola del navegador por errores

### Problema: Los prefijos/sufijos no se ven bien

**Soluci√≥n:**
- Usa prefijos/sufijos cortos (m√°x. 5 caracteres)
- Para iconos, usa emojis o clases de iconos simples
- Revisa el CSS de tu proyecto

---

## üöÄ Pr√≥ximas Caracter√≠sticas

Caracter√≠sticas en desarrollo para futuras versiones:

- üîÑ **Secciones colapsables**: Poder colapsar/expandir secciones
- üìë **Tabs**: Organizar secciones en pesta√±as
- üé® **Temas personalizables**: Colores y estilos por m√≥dulo
- üìù **Validaciones visuales en tiempo real**: Feedback instant√°neo
- üîç **B√∫squeda de campos**: Para formularios muy largos
- üíæ **Autoguardado**: Guardar cambios autom√°ticamente
- üì∏ **Campo de c√°mara**: Capturar fotos directamente
- üó∫Ô∏è **Campo de ubicaci√≥n**: Selector de mapa integrado

---

## üìû Soporte

Si tienes preguntas o encuentras problemas:

1. Revisa este documento
2. Consulta el archivo de ejemplo: `empleados.config.EXAMPLE.ts`
3. Revisa el c√≥digo fuente en:
   - `domain/entities/generic.ts` (tipos)
   - `presentation/components/generic/generic-form-fields.tsx` (renderizado)
   - `presentation/components/generic/generic-form-container.tsx` (contenedor)

---

**¬°Disfruta de tus formularios modernos! üéâ**
