# Gu√≠a: Campos Condicionales en Formularios Gen√©ricos

Esta gu√≠a explica c√≥mo mostrar u ocultar campos din√°micamente en formularios seg√∫n el contexto (creaci√≥n vs edici√≥n).

## üéØ Problema

Necesitas que ciertos campos se comporten diferente dependiendo del modo:
- **Modo creaci√≥n**: Campo oculto (ej: `codigo_cliente` se genera autom√°ticamente)
- **Modo edici√≥n**: Campo visible pero deshabilitado (solo lectura)

## ‚úÖ Soluci√≥n: Uso de `visible` y `disabled`

El sistema de formularios gen√©ricos soporta dos propiedades funcionales:

### 1. `visible: (data) => boolean`

Controla si el campo se muestra o no seg√∫n los datos del formulario.

```typescript
{
    key: 'codigo_cliente',
    label: 'C√≥digo',
    type: 'text',
    visible: (data) => !!data.id, // Solo visible si existe ID (modo edici√≥n)
}
```

### 2. `disabled: (data) => boolean`

Controla si el campo est√° deshabilitado seg√∫n los datos del formulario.

```typescript
{
    key: 'codigo_cliente',
    label: 'C√≥digo',
    type: 'text',
    disabled: () => true, // Siempre deshabilitado
    // O condicional:
    disabled: (data) => !!data.codigo_cliente, // Solo deshabilitado si ya tiene c√≥digo
}
```

## üìã Patrones Comunes

### Patr√≥n 1: Campo solo en EDICI√ìN (solo lectura)

```typescript
{
    key: 'codigo_cliente',
    label: 'C√≥digo de Cliente',
    type: 'text',
    visible: (data) => !!data.id,    // Solo visible en edici√≥n
    disabled: () => true,             // Siempre deshabilitado
    prefix: '#',
}
```

**Uso:** Campos generados autom√°ticamente que el usuario debe ver pero no modificar.

### Patr√≥n 2: Campo solo en EDICI√ìN (modificable)

```typescript
{
    key: 'activo',
    label: 'Cliente activo',
    type: 'boolean',
    visible: (data) => !!data.id,    // Solo visible en edici√≥n
    defaultValue: true,
}
```

**Uso:** Campos de estado que solo tienen sentido despu√©s de crear el registro.

### Patr√≥n 3: Campo solo en CREACI√ìN

```typescript
{
    key: 'password',
    label: 'Contrase√±a',
    type: 'text',
    visible: (data) => !data.id,     // Solo visible al crear
    required: (data) => !data.id,    // Solo requerido al crear
}
```

**Uso:** Campos que solo se necesitan al crear (como contrase√±a inicial).

### Patr√≥n 4: Campo condicional basado en otro campo

```typescript
{
    key: 'nit',
    label: 'NIT',
    type: 'text',
    visible: (data) => data.tipo_documento === 'nit',  // Solo si tipo es NIT
    required: (data) => data.tipo_documento === 'nit',
}
```

**Uso:** Mostrar campos seg√∫n selecciones previas.

### Patr√≥n 5: Campo deshabilitado condicionalmente

```typescript
{
    key: 'precio_venta',
    label: 'Precio de Venta',
    type: 'number',
    disabled: (data) => data.usa_precio_automatico, // Deshabilitar si usa precio autom√°tico
}
```

**Uso:** Deshabilitar campos seg√∫n l√≥gica de negocio.

## üîç C√≥mo funciona internamente

El componente `GenericFormFields` eval√∫a estas funciones:

```typescript
// Verificar visibilidad
const isFieldVisible = (field: FormField<F>): boolean => {
  if (field.hidden) return false;         // hidden est√°tico
  if (field.visible) return field.visible(data); // visible din√°mico
  return true;
};

// Verificar si est√° deshabilitado
const isFieldDisabled = (field: FormField<F>): boolean => {
  if (disabled) return true;              // todo el formulario deshabilitado
  if (field.disabled) return field.disabled(data); // disabled din√°mico
  return false;
};
```

El par√°metro `data` contiene:
- **Al crear**: `{ nombre: '', email: '', ... }` (sin `id`)
- **Al editar**: `{ id: 5, nombre: 'Juan', email: 'juan@mail.com', ... }` (con `id`)

## üí° Tips

1. **Detectar modo edici√≥n**: Usa `!!data.id` para saber si est√°s editando
2. **Combinar propiedades**: Puedes usar `visible` y `disabled` juntos
3. **Campos requeridos condicionalmente**: `required` tambi√©n puede ser funci√≥n
4. **Validaciones condicionales**: `validation` puede depender del contexto

## üìù Ejemplo Completo: Formulario de Cliente

```typescript
formFields: [
    // üìã C√≥digo - Solo en edici√≥n (solo lectura)
    {
        key: 'codigo_cliente',
        label: 'C√≥digo de Cliente',
        type: 'text',
        visible: (data) => !!data.id,
        disabled: () => true,
        prefix: '#',
    },

    // ‚úÖ Estado - Solo en edici√≥n
    {
        key: 'activo',
        label: 'Cliente activo',
        type: 'boolean',
        visible: (data) => !!data.id,
        defaultValue: true,
    },

    // üìÖ Fecha registro - Solo lectura en edici√≥n
    {
        key: 'fecha_registro',
        label: 'Fecha de Registro',
        type: 'date',
        disabled: (data) => !!data.id, // Deshabilitado si ya existe
    },

    // Campos normales siempre visibles
    {
        key: 'nombre',
        label: 'Nombre',
        type: 'text',
        required: true,
    },
]
```

## üöÄ Aplicaci√≥n en otros m√≥dulos

Este patr√≥n funciona en **todos** los m√≥dulos que usan el sistema de formularios gen√©ricos:
- Empleados
- Proveedores
- Productos
- Veh√≠culos
- Almacenes
- etc.

Simplemente aplica las mismas reglas en tu archivo de configuraci√≥n `.config.ts`.
