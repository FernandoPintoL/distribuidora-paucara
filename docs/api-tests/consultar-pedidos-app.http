###
# ═══════════════════════════════════════════════════════════════════════
# PRUEBAS: CONSULTA DE PEDIDOS DESDE LA APP
# ═══════════════════════════════════════════════════════════════════════
#
# Este archivo contiene ejemplos para probar los endpoints de consulta de pedidos
# optimizados para la app del cliente.
#
# REQUISITOS:
# 1. Tener un usuario cliente autenticado (con token Sanctum)
# 2. Tener al menos un pedido creado previamente
#
# CÓMO USAR:
# - Reemplaza {{baseUrl}} con tu URL (ej: http://localhost:8000)
# - Reemplaza {{token}} con tu token de autenticación
# - Reemplaza {{pedidoId}} con un ID de pedido válido
# - Ejecuta cada request con tu cliente HTTP favorito
###

@baseUrl = http://localhost:8000
@token = TU_TOKEN_AQUI
@pedidoId = 1

###
# ═══════════════════════════════════════════════════════════════════════
# 1. LOGIN - Obtener token de autenticación
# ═══════════════════════════════════════════════════════════════════════
POST {{baseUrl}}/api/login
Content-Type: application/json

{
  "usernick": "70123456",
  "password": "70123456"
}

###
# ═══════════════════════════════════════════════════════════════════════
# 2. HISTORIAL DE PEDIDOS - Sin filtros
# ═══════════════════════════════════════════════════════════════════════
# Retorna todos los pedidos del cliente autenticado
GET {{baseUrl}}/api/app/cliente/pedidos
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# 3. HISTORIAL DE PEDIDOS - Con paginación personalizada
# ═══════════════════════════════════════════════════════════════════════
GET {{baseUrl}}/api/app/cliente/pedidos?page=1&per_page=10
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# 4. HISTORIAL DE PEDIDOS - Filtrar por estado PENDIENTE
# ═══════════════════════════════════════════════════════════════════════
GET {{baseUrl}}/api/app/cliente/pedidos?estado=PENDIENTE
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# 5. HISTORIAL DE PEDIDOS - Filtrar por estado APROBADA
# ═══════════════════════════════════════════════════════════════════════
GET {{baseUrl}}/api/app/cliente/pedidos?estado=APROBADA
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# 6. HISTORIAL DE PEDIDOS - Filtrar por rango de fechas
# ═══════════════════════════════════════════════════════════════════════
GET {{baseUrl}}/api/app/cliente/pedidos?fecha_desde=2025-01-01&fecha_hasta=2025-12-31
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# 7. HISTORIAL DE PEDIDOS - Filtros combinados
# ═══════════════════════════════════════════════════════════════════════
GET {{baseUrl}}/api/app/cliente/pedidos?estado=PENDIENTE&fecha_desde=2025-10-01&per_page=5
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# 8. DETALLE COMPLETO DE UN PEDIDO
# ═══════════════════════════════════════════════════════════════════════
# Retorna toda la información del pedido incluyendo:
# - Información del pedido
# - Lista de items con detalles de productos
# - Dirección de entrega
# - Estado de reservas de stock
# - Información de seguimiento
GET {{baseUrl}}/api/app/pedidos/{{pedidoId}}
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# 9. ESTADO ACTUAL DEL PEDIDO (LIGERO)
# ═══════════════════════════════════════════════════════════════════════
# Endpoint ligero que solo retorna el estado actual
# Útil para actualizaciones rápidas en la app
GET {{baseUrl}}/api/app/pedidos/{{pedidoId}}/estado
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# 10. ERROR - Pedido no existe
# ═══════════════════════════════════════════════════════════════════════
GET {{baseUrl}}/api/app/pedidos/999999
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# 11. ERROR - Intentar ver pedido de otro cliente
# ═══════════════════════════════════════════════════════════════════════
# Este debe retornar 403 Forbidden si el pedido existe pero no pertenece al cliente
GET {{baseUrl}}/api/app/pedidos/1
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# 12. ERROR - Sin autenticación
# ═══════════════════════════════════════════════════════════════════════
GET {{baseUrl}}/api/app/cliente/pedidos

###
# ═══════════════════════════════════════════════════════════════════════
# 13. ERROR - Filtros inválidos
# ═══════════════════════════════════════════════════════════════════════
GET {{baseUrl}}/api/app/cliente/pedidos?estado=INVALIDO&per_page=999
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# 14. ERROR - Fecha hasta menor que fecha desde
# ═══════════════════════════════════════════════════════════════════════
GET {{baseUrl}}/api/app/cliente/pedidos?fecha_desde=2025-12-31&fecha_hasta=2025-01-01
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# FLUJO COMPLETO: Crear y consultar pedido
# ═══════════════════════════════════════════════════════════════════════

###
# Paso 1: Crear un nuevo pedido
POST {{baseUrl}}/api/app/pedidos
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "items": [
    {
      "producto_id": 1,
      "cantidad": 2
    }
  ],
  "direccion_id": 1,
  "observaciones": "Pedido de prueba"
}

###
# Paso 2: Ver el historial (debe aparecer el nuevo pedido)
GET {{baseUrl}}/api/app/cliente/pedidos
Authorization: Bearer {{token}}

###
# Paso 3: Ver detalle del pedido recién creado
# (Reemplaza {pedidoId} con el ID retornado en el paso 1)
GET {{baseUrl}}/api/app/pedidos/1
Authorization: Bearer {{token}}

###
# Paso 4: Verificar estado del pedido
GET {{baseUrl}}/api/app/pedidos/1/estado
Authorization: Bearer {{token}}

###
# ═══════════════════════════════════════════════════════════════════════
# RESPUESTAS ESPERADAS
# ═══════════════════════════════════════════════════════════════════════
#
# HISTORIAL (200 OK):
# {
#   "success": true,
#   "data": {
#     "pedidos": [
#       {
#         "id": 1,
#         "codigo": "PRO-20251017-0001",
#         "fecha": "2025-10-17",
#         "estado": "PENDIENTE",
#         "total": 113.00,
#         "moneda": "BOB",
#         "cantidad_items": 2,
#         "total_productos": 3,
#         "tiene_reserva_activa": true,
#         "items_preview": [...]
#       }
#     ],
#     "paginacion": {
#       "total": 10,
#       "por_pagina": 15,
#       "pagina_actual": 1,
#       "ultima_pagina": 1
#     },
#     "resumen": {
#       "total_pedidos": 10,
#       "pendientes": 3,
#       "aprobados": 5
#     }
#   }
# }
#
# DETALLE COMPLETO (200 OK):
# {
#   "success": true,
#   "data": {
#     "pedido": {...},
#     "items": [...],
#     "direccion_entrega": {...},
#     "reservas_stock": {...},
#     "seguimiento": {...}
#   }
# }
#
# ESTADO (200 OK):
# {
#   "success": true,
#   "data": {
#     "id": 1,
#     "codigo": "PRO-20251017-0001",
#     "estado": "PENDIENTE",
#     "estado_detalle": {
#       "descripcion": "Tu pedido está siendo revisado por nuestro equipo",
#       "color": "#FFA500",
#       "icono": "clock"
#     },
#     "tiene_reserva_activa": true,
#     "reserva_info": {
#       "fecha_expiracion": "2025-10-18 10:00:00",
#       "tiempo_restante_horas": 22.5
#     }
#   }
# }
#
# ERROR - Pedido no encontrado (404):
# {
#   "success": false,
#   "message": "Pedido no encontrado"
# }
#
# ERROR - Sin permiso (403):
# {
#   "success": false,
#   "message": "No tienes permiso para ver este pedido"
# }
#
###
