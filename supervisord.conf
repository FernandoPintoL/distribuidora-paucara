[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid

[program:app-key]
command=/bin/sh -lc 'set -e; if [ "$APP_ENV" = "production" ]; then rm -f .env; fi; if [ -z "$APP_KEY" ]; then if [ -f .env ]; then if ! grep -q "^APP_KEY=base64:" .env; then php artisan key:generate --force; fi; fi; fi; php artisan config:clear || true && php artisan config:cache || true'
autostart=true
autorestart=false
startsecs=0
exitcodes=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=1

[program:permissions-fix]
command=/bin/sh -lc 'echo "üîê [permissions-fix] Verificando permisos en runtime..."; cd /app; chmod -R 777 storage/ public/bootstrap/cache public/build 2>/dev/null || true; echo "‚úÖ [permissions-fix] Permisos ajustados: storage/=777, public/bootstrap/cache=777"; ls -ld storage/ | sed "s/^/   /"; ls -ld storage/app/public/clientes 2>/dev/null | sed "s/^/   /" || mkdir -p storage/app/public/clientes && chmod 777 storage/app/public/clientes && echo "   ‚úÖ Directorio clientes creado"; echo "‚úÖ [permissions-fix] ¬°Completado!"'
autostart=true
autorestart=false
startsecs=0
exitcodes=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=3

[program:storage-link]
command=/bin/sh -lc 'set -e; echo "üîó [storage-link] Iniciando..."; cd /app; echo "üìÅ Verificando directorios..."; ls -ld storage/app/public 2>/dev/null && echo "‚úÖ [storage-link] Directorio storage/app/public existe" || echo "‚ö†Ô∏è [storage-link] Directorio storage/app/public NO existe"; echo "üóëÔ∏è Forzando eliminaci√≥n de symlink anterior..."; rm -f public/storage 2>/dev/null || true; php artisan storage:unlink 2>&1 || true; echo "‚úÖ Symlink eliminado (o no exist√≠a)"; echo "üîó Creando symlink storage:link..."; php artisan storage:link 2>&1 || (echo "‚ùå [storage-link] Error al crear symlink!" && exit 1); echo "üìÅ Verificando symlink..."; if [ -L public/storage ]; then echo "‚úÖ [storage-link] Symlink creado correctamente: $(readlink -f public/storage)"; else echo "‚ùå [storage-link] El symlink public/storage NO existe!"; exit 1; fi; echo "üîê Ajustando permisos finales..."; chmod -R 777 storage/ public/bootstrap/cache; echo "üìä Estado final de permisos:"; ls -ld storage/ public/storage public/bootstrap/cache 2>/dev/null || echo "‚ö†Ô∏è Algunos directorios no existen a√∫n"; echo "‚úÖ [storage-link] ¬°Completado exitosamente!"'
autostart=true
autorestart=false
startsecs=0
exitcodes=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=5

[program:php-fpm]
command=php-fpm
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10

[program:nginx]
command=nginx -g "daemon off;" -c /app/nginx.conf
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=20
