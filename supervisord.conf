[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid

[program:app-key]
command=/bin/sh -lc 'set -e; if [ "$APP_ENV" = "production" ]; then rm -f .env; fi; if [ -z "$APP_KEY" ]; then if [ -f .env ]; then if ! grep -q "^APP_KEY=base64:" .env; then php artisan key:generate --force; fi; fi; fi; php artisan config:clear || true && php artisan config:cache || true'
autostart=true
autorestart=false
startsecs=0
exitcodes=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=1

[program:storage-link]
command=/bin/sh -lc 'set -e; echo "ğŸ”— [storage-link] Iniciando..."; cd /app; echo "ğŸ“ Verificando directorios..."; ls -ld storage/app/public 2>/dev/null && echo "âœ… [storage-link] Directorio storage/app/public existe" || echo "âš ï¸ [storage-link] Directorio storage/app/public NO existe"; echo "ğŸ—‘ï¸ Eliminando symlink anterior (si existe)..."; php artisan storage:unlink 2>&1 || echo "[storage-link] No habÃ­a symlink anterior (es normal)"; echo "ğŸ”— Creando symlink storage:link..."; php artisan storage:link 2>&1 || (echo "âŒ [storage-link] Error al crear symlink!" && exit 1); echo "ğŸ“ Verificando symlink..."; if [ -L public/storage ]; then echo "âœ… [storage-link] Symlink creado correctamente: $(readlink -f public/storage)"; else echo "âŒ [storage-link] El symlink public/storage NO existe!"; exit 1; fi; echo "ğŸ” Ajustando permisos..."; chmod -R 777 storage/ public/bootstrap/cache; echo "ğŸ“Š Estado final de permisos:"; ls -ld storage/ public/storage public/bootstrap/cache; echo "âœ… [storage-link] Â¡Completado exitosamente!"'
autostart=true
autorestart=false
startsecs=0
exitcodes=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=5

[program:php-fpm]
command=php-fpm
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10

[program:nginx]
command=nginx -g "daemon off;" -c /app/nginx.conf
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=20
