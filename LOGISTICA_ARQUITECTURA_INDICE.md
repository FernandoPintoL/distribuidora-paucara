# üìö √çNDICE DE ARQUITECTURA - M√ìDULO LOG√çSTICA v2.0

**Fecha:** 31 de Octubre de 2025
**Versi√≥n:** 2.0 (Separada por Plataforma)
**Estado General:** ‚úÖ Fase 1 completada, ‚ö†Ô∏è Fases 2-4 en plan

---

## üìñ DOCUMENTOS PRINCIPALES

Esta documentaci√≥n est√° **separada por plataforma y responsabilidad** para que cada equipo trabaje de forma aut√≥noma:

### 1. üè¢ **BACKEND_LOGISTICA.md**
**Responsable:** Gestor de Backend
**Plataforma:** Laravel 10+ / PHP
**Alcance:** API, Modelos, Migraciones, Eventos, Broadcasting

**Incluye:**
- Estado actual de implementaci√≥n (Proforma ‚úÖ, Chofer ‚ö†Ô∏è, Entrega ‚ùå)
- Modelos de datos (cu√°les existen, cu√°les faltan crear)
- 3 Controladores faltantes a implementar (EntregaController, TrackingController, EncargadoController)
- Rutas API completas (GET, POST, PUT, DELETE)
- Eventos de Broadcasting (8 eventos a crear)
- Checklist de implementaci√≥n por fase

**Pr√≥ximos pasos Backend:**
1. Crear modelos: Entrega, UbicacionTracking, EntregaEstadoHistorial
2. Crear 3 controladores API
3. Crear 8 eventos para Broadcasting
4. Implementar rutas y servicios de negocio
5. Testing de endpoints

---

### 2. üåê **FRONTEND_REACT_LOGISTICA.md**
**Responsable:** Gestor de React
**Plataforma:** React 18+ (con Inertia.js)
**Alcance:** Web UI para Encargado de Log√≠stica

**Incluye:**
- 10+ p√°ginas nuevas a crear (proformas, entregas, mapa, gesti√≥n)
- 8+ componentes reutilizables
- Hooks personalizados para estado
- Integraci√≥n de mapas (Leaflet recomendado)
- Integraci√≥n WebSocket para actualizaciones
- Checklist de implementaci√≥n (7 fases)

**Rol del Encargado:**
- Verificar y aprobar proformas
- Asignar chofer y veh√≠culo
- Procesar carga al veh√≠culo
- Monitorear entregas en mapa (tracking)
- Confirmar entregas
- Reportes

**Pr√≥ximos pasos React:**
1. Crear estructura de carpetas
2. Implementar p√°ginas de proformas
3. Implementar p√°ginas de entregas
4. Crear mapa con tracking
5. Integraci√≥n WebSocket

---

### 3. üì± **FRONTEND_FLUTTER_LOGISTICA.md**
**Responsable:** Gestor de Flutter
**Plataforma:** Flutter 3.x (iOS + Android)
**Alcance:** App m√≥vil para Cliente y Chofer

**Incluye:**
- Estado actual: Fase 1 (Cliente) ‚úÖ 98% listo, Fase 3 (Chofer) ‚ùå 0% iniciada
- Modelos de datos (falta: Entrega)
- Servicios y Providers (falta: ChoferService, GeolocationService)
- 9+ screens nuevas para rol Chofer
- Sistema de tracking GPS
- Firma digital y captura de fotos
- **NUEVO:** Chofer puede crear clientes en ruta
- Checklist por fase

**Roles:**
- **Cliente (Fase 1 ‚úÖ):** Carrito, Pedidos, Tracking
- **Chofer (Fase 3 ‚ùå):** Entregas, Ubicaci√≥n GPS, Confirmaci√≥n, Crear clientes

**Pr√≥ximos pasos Flutter:**
1. Crear modelo Entrega (CR√çTICO)
2. Crear ChoferService y ChoferProvider
3. Crear HomeChoferScreen
4. Crear screens de entregas (5 nuevas)
5. Integraci√≥n de tracking GPS
6. Testing en dispositivo real

---

### 4. üîå **WEBSOCKET_ARCHITECTURE.md**
**Responsable:** Gestor de Backend / WebSocket
**Plataforma:** Node.js + Socket.IO
**Alcance:** Comunicaci√≥n en tiempo real (transversal a todas las plataformas)

**Incluye:**
- Arquitectura general de WebSocket
- Servidor Node.js (./websocket/) - ‚úÖ Implementado
- 9 eventos principales para log√≠stica
- Canales (pedido.{id}, entrega.{id}, chofer.{id}, admin.pedidos)
- Integraci√≥n Backend (Laravel Broadcasting)
- Integraci√≥n React (socket.io-client)
- Integraci√≥n Flutter (laravel_echo)
- Flujo de mensajes con latencias
- Troubleshooting

**Por qu√© WebSocket:**
- Tracking en tiempo real (< 500ms)
- Notificaciones instant√°neas
- Eficiencia (vs polling cada 5s)
- Baja latencia, menos bater√≠a

**Pr√≥ximos pasos WebSocket:**
1. Backend: Configurar Broadcasting (Pusher/Reverb)
2. Backend: Crear 8 eventos
3. React: Integrar WebSocket en TrackingMapa
4. Flutter: Expandir WebSocketService
5. Testing end-to-end

---

## üéØ RELACI√ìN ENTRE DOCUMENTOS

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              BACKEND_LOGISTICA.md                           ‚îÇ
‚îÇ  - API REST: /api/chofer, /api/encargado, /api/tracking     ‚îÇ
‚îÇ  - Eventos: UbicacionActualizada, ChoferLlego, etc.         ‚îÇ
‚îÇ  - Broadcasting: Laravel ‚Üí WebSocket                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îò
             ‚îÇ                                              ‚îÇ
             ‚îÇ Consume API                        Dispara eventos
             ‚îÇ                                              ‚îÇ
             ‚ñº                                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ FRONTEND_REACT.md          ‚îÇ              ‚îÇ WEBSOCKET_ARCHITECTURE   ‚îÇ
‚îÇ (Encargado - Dashboard)    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  (Socket.IO Server)     ‚îÇ
‚îÇ                            ‚îÇ   Escucha      (/websocket/)           ‚îÇ
‚îÇ - Proformas                ‚îÇ   eventos      ‚îú‚îÄ 9 eventos            ‚îÇ
‚îÇ - Entregas                 ‚îÇ               ‚îú‚îÄ 4 canales             ‚îÇ
‚îÇ - Mapa + Tracking          ‚îÇ               ‚îî‚îÄ Broadcasting          ‚îÇ
‚îÇ - Gesti√≥n Choferes/Camiones‚îÇ                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                     ‚ñ≤
                                                     ‚îÇ
                                                     ‚îÇ
                                            Escucha eventos
                                                     ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ FRONTEND_FLUTTER.md        ‚îÇ
‚îÇ (Cliente + Chofer)         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ CLIENTE (Fase 1 ‚úÖ):       ‚îÇ
‚îÇ - Carrito ‚Üí Pedidos        ‚îÇ
‚îÇ - Tracking en Mapa         ‚îÇ
‚îÇ - Recibe eventos           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ CHOFER (Fase 3 ‚ùå):        ‚îÇ
‚îÇ - Entregas Diarias         ‚îÇ
‚îÇ - Ubicaci√≥n GPS (cada 15s) ‚îÇ
‚îÇ - Firma Digital + Fotos    ‚îÇ
‚îÇ - Crear Clientes           ‚îÇ
‚îÇ - Env√≠a eventos (GPS)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä ESTADO GENERAL DE IMPLEMENTACI√ìN

### Fase 1: CLIENTE - PEDIDOS ‚úÖ 98% LISTO
```
BACKEND:        ‚úÖ Completado (ApiProformaController)
FRONTEND REACT: ‚ö†Ô∏è  Parcial (dashboard existente, falta p√°ginas)
FRONTEND FLUTTER: ‚úÖ Completado
WEBSOCKET:      ‚ö†Ô∏è  Configurado pero no fully integrated
STATUS:         üü¢ LISTO PARA QA EN FLUTTER, espera React
```

### Fase 2: NOTIFICACIONES ‚ùå NO INICIADA
```
BACKEND:        ‚ö†Ô∏è  Eventos creados, FCM no integrado
FRONTEND REACT: ‚ùå No iniciado
FRONTEND FLUTTER: ‚ùå Firebase Messaging no instalado
WEBSOCKET:      ‚úÖ Escucha eventos
STATUS:         üî¥ BLOQUEADO: Espera Backend crear eventos
```

### Fase 3: CHOFER - ENTREGAS ‚ùå NO INICIADA
```
BACKEND:        ‚ùå Falta: 3 Controllers, Model Entrega
FRONTEND REACT: ‚ùå No iniciado (opcional, principalmente Flutter)
FRONTEND FLUTTER: ‚ùå 0% - Cr√≠tico para log√≠stica
WEBSOCKET:      ‚úÖ Escucha eventos
STATUS:         üî¥ BLOQUEADO: Espera Backend crear modelos/API
```

### Fase 4: ADMIN ‚ùå NO INICIADA
```
BACKEND:        ‚ùå Falta: EncargadoController
FRONTEND REACT: ‚ùå Depende de Backend
WEBSOCKET:      ‚úÖ Canal admin.pedidos existe
STATUS:         üî¥ BLOQUEADO: Espera Backend
```

### Fase 5: PULIDO Y RELEASE ‚è≥ PENDIENTE
```
BACKEND:        Depende de fases 2-4
FRONTEND:       Depende de backend
TESTING:        End-to-end en ambas plataformas
STATUS:         ‚è≥ Espera completar fases anteriores
```

---

## üöÄ ORDEN RECOMENDADO DE TRABAJO

### SEMANA 1: BACKEND (Bloqueante para todo lo dem√°s)

1. **Gestor Backend:**
   - [ ] Crear Model `Entrega`
   - [ ] Crear Model `UbicacionTracking`
   - [ ] Crear Model `EntregaEstadoHistorial`
   - [ ] Crear migration para `entregas` table
   - [ ] Crear migration para `ubicaciones_tracking` table
   - [ ] Migrations: `php artisan migrate`
   - **Timeline:** 2-3 d√≠as

2. **Gestor Backend:**
   - [ ] Crear `EntregaController` (API) con 8+ m√©todos
   - [ ] Crear `TrackingController` (API)
   - [ ] Registrar rutas en `routes/api.php`
   - [ ] Testing b√°sico de endpoints (Postman)
   - **Timeline:** 2-3 d√≠as

3. **Gestor Backend:**
   - [ ] Crear 8 eventos (ProformaAprobada, UbicacionActualizada, etc.)
   - [ ] Configurar Broadcasting en `config/broadcasting.php`
   - [ ] Definir canales en `routes/channels.php`
   - [ ] Disparar eventos en controladores
   - [ ] Testing: verificar eventos llegan al WebSocket
   - **Timeline:** 2-3 d√≠as

**Deliverable semana 1:** Backend completamente funcional + documentaci√≥n de API

---

### SEMANA 2: REACT Y FLUTTER (En paralelo)

**Gestor React:**
- [ ] Crear estructura de carpetas
- [ ] Implementar `useLogistica()` hook
- [ ] Crear p√°gina ProformasPendientes + ProformaDetalle
- [ ] Crear p√°gina EntregasPreparacion
- [ ] Crear p√°gina EntregasTransitoMapa (con Leaflet)
- [ ] Integrar WebSocket en mapa
- **Timeline:** 4-5 d√≠as

**Gestor Flutter:**
- [ ] Crear Model `Entrega`
- [ ] Crear `ChoferService` con todos los m√©todos
- [ ] Crear `ChoferProvider`
- [ ] Crear `HomeChoferScreen` (principal)
- [ ] Crear `EntregasAsignadasScreen`
- [ ] Testing b√°sico
- **Timeline:** 4-5 d√≠as

---

### SEMANA 3: CHOFERES Y TRACKING

**Gestor Flutter (continuaci√≥n):**
- [ ] Crear `EntregaDetalleScreen`
- [ ] Crear `FirmaDigitalScreen` (con signature)
- [ ] Crear `GeolocationService` (GPS)
- [ ] Implementar tracking GPS (enviar ubicaci√≥n cada 15s)
- [ ] Integrar WebSocket para recibir eventos
- [ ] Testing en dispositivo real (no emulador)
- **Timeline:** 3-4 d√≠as

**Gestor React (continuaci√≥n):**
- [ ] Crear p√°gina ReportarNovedad
- [ ] Crear p√°ginas de Gesti√≥n (Choferes, Camiones)
- [ ] Crear p√°gina de Reportes
- [ ] Pulir UI/UX
- **Timeline:** 3-4 d√≠as

---

### SEMANA 4: QA Y RELEASE

- [ ] Testing end-to-end (Cliente + Chofer + Admin simult√°neamente)
- [ ] Testing WebSocket en tiempo real
- [ ] Performance testing (m√∫ltiples entregas)
- [ ] Bug fixes
- [ ] Preparar release v2.0

---

## üí° CONSIDERACIONES IMPORTANTES

### 1. WebSocket es CR√çTICO
- Sin WebSocket, no hay tracking en tiempo real
- Debe estar funcionando antes de hacer testing real
- Servidor Node.js debe estar corriendo en producci√≥n

### 2. Backend bloquea a Frontend
- Frontend no puede empezar hasta que Backend tenga endpoints
- Usar mocks/stubs si Backend atrasa

### 3. Fases son secuenciales
- No se puede hacer Fase 4 sin Fase 3
- No se puede hacer Fase 3 sin modelos Backend

### 4. Testing en Dispositivo Real
- Emulador NO simula GPS correctamente
- Emulador NO simula conexi√≥n de fondo
- **IMPORTANTE:** Hacer testing en Android/iOS f√≠sicos

---

## üõ†Ô∏è COMANDOS √öTILES

### Backend Laravel
```bash
# Crear modelo y migration
php artisan make:model Entrega -m

# Crear controller
php artisan make:controller Api/EntregaController

# Crear evento
php artisan make:event UbicacionActualizada

# Run migrations
php artisan migrate

# Test API
php artisan tinker
>>> Entrega::all()
```

### Flutter
```bash
# Instalar dependencias
flutter pub get

# Instalar package espec√≠fico
flutter pub add signature

# Run en dispositivo
flutter run

# Build APK
flutter build apk

# Build IPA
flutter build ios
```

### WebSocket
```bash
# Iniciar servidor
cd websocket
npm install
npm start

# Verificar que est√° corriendo
curl http://localhost:3001
```

---

## üìû CONTACTO Y ESCALAMIENTO

**Si hay bloqueadores:**

1. **Bloqueador Frontend React:** Contactar Gestor Backend
   - Falta endpoint ‚Üí crear endpoint
   - Falta evento ‚Üí crear evento
   - WebSocket no funciona ‚Üí revisar server

2. **Bloqueador Frontend Flutter:** Contactar Gestor Backend (mismo)
   - Falta API ‚Üí crear API
   - Falta modelo ‚Üí crear modelo
   - Permisos fallando ‚Üí revisar autorizaciones

3. **Bloqueador WebSocket:** Contactar Gestor Backend + WebSocket
   - Servidor no responde ‚Üí restart server
   - Eventos no llegan ‚Üí revisar Broadcasting config
   - Latencia alta ‚Üí revisar network

---

## üìã CHECKLIST FINAL

Antes de release v2.0:

- [ ] Backend: Todos los modelos creados y migraciones ejecutadas
- [ ] Backend: Todos los endpoints funcionando
- [ ] Backend: Todos los eventos dispar√°ndose correctamente
- [ ] React: Todas las p√°ginas de log√≠stica implementadas
- [ ] React: Mapa con tracking en tiempo real funcionando
- [ ] Flutter: Modelo Entrega implementado
- [ ] Flutter: ChoferProvider con state management completo
- [ ] Flutter: 9+ screens para chofer implementadas
- [ ] Flutter: GPS tracking funcionando en dispositivo real
- [ ] WebSocket: Servidor corriendo y estable
- [ ] Testing: End-to-end con m√∫ltiples usuarios
- [ ] Testing: WebSocket con 50+ ubicaciones/segundo
- [ ] Documentaci√≥n: APIs documentadas en Swagger
- [ ] Documentaci√≥n: Gu√≠as de deployment por ambiente
- [ ] Performance: App Flutter sin memory leaks
- [ ] Performance: Mapa React fluido con 100+ pins
- [ ] Seguridad: Autorizaciones verificadas en todos los endpoints
- [ ] Monitoreo: Logs de errores configurados (Sentry)
- [ ] Release: v2.0 publicada en App Store / Google Play

---

## üìö REFERENCIAS √öTILES

**Documentaci√≥n:**
- [Laravel Broadcasting](https://laravel.com/docs/broadcasting)
- [Socket.IO](https://socket.io/docs/)
- [React Leaflet](https://react-leaflet.js.org/)
- [Flutter Geolocator](https://pub.dev/packages/geolocator)

**Ejemplos en el proyecto:**
- Backend: `app/Models/Proforma.php` (referencia de modelo completo)
- React: `resources/js/presentation/pages/logistica/dashboard.tsx` (referencia UI)
- Flutter: `lib/screens/cliente/pedidos/pedido_tracking_screen.dart` (referencia)

---

## üìù HISTORIAL DE VERSIONES

| Versi√≥n | Fecha | Cambios |
|---------|-------|---------|
| 1.0 | 2025-10-18 | Documento √∫nico sin separaci√≥n por plataforma |
| 2.0 | 2025-10-31 | **Separado en 4 docs** (Backend, React, Flutter, WebSocket) + √çndice |

**Pr√≥xima versi√≥n:** 2.1 (despu√©s de completar Fase 3)

---

**Responsables globales:**
- üè¢ Backend: Gestor de Backend
- üåê React: Gestor de React
- üì± Flutter: Gestor de Flutter
- üîå WebSocket: Gestor de Backend + WebSocket

**√öltima actualizaci√≥n:** 31 de Octubre de 2025
**Estado:** Activo - En desarrollo Fase 2+
